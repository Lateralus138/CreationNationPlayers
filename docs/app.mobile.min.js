document.addEventListener("DOMContentLoaded",()=>{const playersTbody=document.getElementById("players-tbody");const playerCountSpan=document.getElementById("player-count");const lastUpdatedSpan=document.getElementById("last-updated");const updateIntervalInput=document.getElementById("update-interval");const autoUpdateCheckbox=document.getElementById("auto-update");const refreshBtn=document.getElementById("refresh-btn");const resetBtn=document.getElementById("reset-btn");const playersTable=document.getElementById("players-table");let playersData=[];let sortColumn=null;let sortAscending=true;let updateInterval;const worldsMap={minecraft_overworld:"Overworld",minecraft_the_nether:"Nether",minecraft_privatearea:"PMAP",minecraft_spawn:"Spawn",minecraft_the_end:"End",minecraft_pmz_nether:"PMZ Nether",minecraft_pmz_end:"PMZ End",minecraft_pmz:"PMZ",minecraft_graveyard_0:"Dead",minecraft_colosseum_0:"Orc Revenge Dungeon",minecraft_orc_revenge_0:"Orc Revenge Dungeon",minecraft_colosseum_1:"Skeleton's Colleseum",null:"N/A"};async function fetchPlayers(){try{const response=await fetch("https://map.cnation.net/tiles/players.json",{cache:"no-cache"});if(!response.ok){throw new Error(`HTTP error! status: ${response.status}`)}const data=await response.json();playersData=data.players.map(player=>({name:player.name||"N/A",world:player.world||"null",health:player.health!==undefined?Math.round(player.health):"N/A",armor:player.armor!==undefined?Math.round(player.armor):"N/A",x:player.x!==undefined?Math.round(player.x):"N/A",z:player.z!==undefined?Math.round(player.z):"N/A",uuid:player.uuid||""}));renderPlayers();updateStatus()}catch(error){console.error("Failed to fetch player data:",error);lastUpdatedSpan.textContent=`Last Updated: Error`}}function renderPlayers(){if(sortColumn){sortData()}playersTbody.innerHTML="";playersData.forEach(player=>{const row=document.createElement("tr");row.addEventListener("dblclick",()=>copyPlayerInfoToClipboard(player));const worldName=worldsMap[player.world]||player.world;row.innerHTML=`\n                <td><img src="https://mc-heads.net/avatar/${player.uuid}/16" class="player-avatar" alt=""> ${player.name}</td>\n                <td>${player.x}</td>\n                <td>${player.z}</td>\n                <td>${worldName}</td>\n                <td>${player.health}</td>\n                <td>${player.armor}</td>\n            `;playersTbody.appendChild(row)})}function updateStatus(){playerCountSpan.textContent=`Players: ${playersData.length}`;lastUpdatedSpan.textContent=`Last Updated: ${(new Date).toLocaleTimeString()}`}function copyPlayerInfoToClipboard(player){const worldName=worldsMap[player.world]||player.world;const info=`Name: ${player.name}, World: ${worldName}, Health: ${player.health}, Armor: ${player.armor}, X: ${player.x}, Z: ${player.z}`;navigator.clipboard.writeText(info).then(()=>{}).catch(err=>{console.error("Failed to copy text: ",err)})}function sortData(){playersData.sort((a,b)=>{let valA=a[sortColumn];let valB=b[sortColumn];const numericColumns=["health","armor","x","z"];if(numericColumns.includes(sortColumn)){valA=Number(valA);valB=Number(valB)}else if(typeof valA==="string"){valA=valA.toLowerCase()}if(typeof valB==="string"){valB=valB.toLowerCase()}if(valA<valB){return sortAscending?-1:1}if(valA>valB){return sortAscending?1:-1}return 0})}function handleSort(e){const newSortColumn=e.target.dataset.column;if(sortColumn===newSortColumn){sortAscending=!sortAscending}else{sortColumn=newSortColumn;sortAscending=true}document.querySelectorAll("#players-table th").forEach(th=>{th.querySelector(".sort-indicator")?.remove()});const indicator=document.createElement("span");indicator.classList.add("sort-indicator");indicator.textContent=sortAscending?" ▲":" ▼";e.target.appendChild(indicator);renderPlayers()}function startUpdateInterval(){if(updateInterval){clearInterval(updateInterval)}if(autoUpdateCheckbox.checked){const interval=parseInt(updateIntervalInput.value,10);if(!isNaN(interval)&&interval>=5e3){updateInterval=setInterval(fetchPlayers,interval)}}}playersTable.querySelectorAll("th").forEach(th=>{th.addEventListener("click",handleSort)});refreshBtn.addEventListener("click",fetchPlayers);resetBtn.addEventListener("click",()=>{updateIntervalInput.value="30000";startUpdateInterval()});autoUpdateCheckbox.addEventListener("change",startUpdateInterval);updateIntervalInput.addEventListener("change",()=>{const interval=parseInt(updateIntervalInput.value,10);if(isNaN(interval)||interval<5e3){updateIntervalInput.value="5000"}startUpdateInterval()});document.addEventListener("keydown",e=>{if(e.altKey&&e.key.toLowerCase()==="r"){e.preventDefault();resetBtn.click()}if(e.altKey&&e.key.toLowerCase()==="u"){e.preventDefault();autoUpdateCheckbox.checked=!autoUpdateCheckbox.checked;autoUpdateCheckbox.dispatchEvent(new Event("change"))}});const copyIpBtn=document.getElementById("copy-ip-btn");copyIpBtn.addEventListener("click",()=>{const ip="play.cnation.net";navigator.clipboard.writeText(ip).then(()=>{const originalText=copyIpBtn.textContent;copyIpBtn.textContent="Copied!";setTimeout(()=>{copyIpBtn.textContent=originalText},2e3)}).catch(err=>{console.error("Failed to copy IP address: ",err)})});fetchPlayers();startUpdateInterval()});